<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="author" content="Untree.co">

    <meta name="description" content="" />
    <meta name="keywords" content="bootstrap, bootstrap5" />

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="css/tiny-slider.css">
    <link rel="stylesheet" href="css/aos.css">
    <link rel="stylesheet" href="css/glightbox.min.css">
    <link rel="stylesheet" href="css/style.css">
    <title>Place</title>
</head>
<body>
<div th:replace="fragments/bodyHeader :: bodyHeader" />

<div id ="map" style="width: 500px; height: 400px">
  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=ca7a07b349f18154bcc92b17665e7b50">
  </script>
  <script>
    let container = document.getElementById('map'); //지도를 담을 영역의 DOM 레퍼런스
    let options = { //지도를 생성할 때 필요한 기본 옵션
      center: new kakao.maps.LatLng(37.58201688858207, 127.00191330927217), //지도의 중심좌표.
      level: 3 //지도의 레벨(확대, 축소 정도)
    };
    let map = new kakao.maps.Map(container, options);

    function showMarkers() {
        tables.map(element => {
            const marker = new kakao.maps.Marker({
                map: map,
                position: new kakao.maps.LatLng(element.y_DNTS, element.x_CNTS),
                title: element.upso_NM,
            });
            /* 마커에 표시할 인포윈도우를 생성 */
            let infowindow = new kakao.maps.InfoWindow({
                content: `
                <div style='width:max-content'>
                <div style='color: black; font-size:17px; font-weight:bold; margin:5px 5px 0 5px'>${element.upso_NM}</div>
                <div style='margin:0px 5px; font-weight:bold; font-size:13px;'>☎${element.tel_NO}</div>
                <div style='font-size:12px; margin:0px 5px 5px 5px'>${element.rdn_CODE_NM}</div>
                </div>
                `
            });
            kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow));
            kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow));
            kakao.maps.event.addListener(marker, 'click', function () {
                changeShowDetail(element);
            });
        });
    }
    showMarkers();

    function makeOverListener(map, marker, infowindow) {
        return function () {
            infowindow.open(map, marker);
        };
    }

    /* 인포윈도우 닫기 */
    function makeOutListener(infowindow) {
        return function () {
            infowindow.close();
        };
    }

    /* 지도 중심 좌표 이동 */
    const moveMapCenter = (el) => {
        let moveLatLon = new kakao.maps.LatLng(el.y_DNTS, el.x_CNTS);
        map.setCenter(moveLatLon);
    }

  </script>
</div>
</body>
</html>